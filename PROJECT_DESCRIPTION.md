# Подробное описание проекта ChessBGPU

## Общее описание

ChessBGPU - это мобильное приложение для игры в шахматы, разработанное для платформы Android. Приложение предоставляет полноценный функционал для игры в шахматы, включая игру против компьютера, анализ партий, решение шахматных задач, обучение и редактирование шахматной доски. Приложение разработано с использованием современных технологий и архитектурных подходов.

## Технологии и языки программирования

### Основной стек технологий:
1. **Kotlin** - основной язык программирования для разработки Android-приложений
2. **Jetpack Compose** - современный декларативный UI-фреймворк для создания пользовательского интерфейса
3. **Android Architecture Components** - набор библиотек для создания надежных, тестируемых и поддерживаемых приложений:
   - ViewModel - для управления данными, связанными с UI
   - Room - для работы с локальной базой данных
   - Navigation - для управления навигацией между экранами
   - StateFlow и Flow - для реактивного программирования и обновления UI
4. **Coroutines** - для асинхронного и неблокирующего программирования
5. **Material Design 3** - для современного и согласованного дизайна приложения

## Архитектура приложения

Приложение построено на основе архитектурного паттерна MVVM (Model-View-ViewModel), что обеспечивает четкое разделение ответственности между компонентами:

1. **Model** - представлен классами в пакете `com.chunosov.chessbgpu.model`, содержит бизнес-логику и данные:
   - `ChessBoard` - модель шахматной доски
   - `ChessPiece` - базовый класс для шахматных фигур
   - `Move` - представление хода в шахматной партии
   - `Game` - модель шахматной партии
   - `SavedGame` - модель сохраненной партии
   - `AppSettings` - модель настроек приложения

2. **View** - представлен Composable-функциями в пакете `com.chunosov.chessbgpu.ui.screens`:
   - `MainMenuScreen` - главное меню приложения
   - `GameScreen` - экран игры в шахматы
   - `AnalysisScreen` - экран анализа партий
   - `BoardEditorScreen` - экран редактора доски
   - `SettingsScreen` - экран настроек
   - `TasksScreen` - экран шахматных задач
   - `PuzzleSolverScreen` - экран решения шахматных задач
   - `LearningScreen` - экран обучения

3. **ViewModel** - представлен классами в пакете `com.chunosov.chessbgpu.viewmodel`:
   - `ChessViewModel` - основной ViewModel для управления шахматной игрой
   - `SettingsViewModel` - ViewModel для управления настройками приложения

## Навигация

Навигация в приложении реализована с использованием Jetpack Navigation Component. Основной класс навигации - `NavGraph.kt`, который определяет все доступные экраны и переходы между ними. Каждый экран представлен объектом в sealed классе `Screen`.

Основные экраны приложения:
- Главное меню
- Настройки игры
- Игра
- Анализ партий
- Задачи
- Решение задач
- Обучение
- Настройки
- Сохраненные партии
- Просмотр партии
- Редактор доски

## Шахматная логика

### Представление шахматной доски

Шахматная доска представлена классом `ChessBoard`, который содержит двумерный массив клеток, каждая из которых может содержать шахматную фигуру. Координаты на доске представлены в стандартной шахматной нотации (a1-h8).

### Шахматные фигуры

Все шахматные фигуры наследуются от абстрактного класса `ChessPiece`, который определяет общие свойства и методы для всех фигур:
- Тип фигуры (пешка, ладья, конь, слон, ферзь, король)
- Цвет фигуры (белый, черный)
- Методы для проверки возможности хода
- Методы для получения всех возможных ходов

Конкретные реализации для каждого типа фигур определяют специфическую логику перемещения:
- `Pawn` - пешка (движение вперед, взятие по диагонали, превращение)
- `Rook` - ладья (движение по горизонтали и вертикали)
- `Knight` - конь (движение буквой "Г")
- `Bishop` - слон (движение по диагонали)
- `Queen` - ферзь (комбинация движений ладьи и слона)
- `King` - король (движение на одну клетку в любом направлении, рокировка)

### Ходы и правила игры

Класс `Move` представляет ход в шахматной партии и содержит:
- Начальную позицию
- Конечную позицию
- Тип хода (обычный, взятие, рокировка, превращение пешки)
- Взятую фигуру (если применимо)
- Новую фигуру при превращении пешки (если применимо)

Правила шахмат реализованы в классе `ChessRules`, который проверяет:
- Возможность хода для каждого типа фигур
- Шах и мат
- Пат
- Рокировку
- Взятие на проходе
- Превращение пешки

### Шахматный движок

Для игры против компьютера используется встроенный шахматный движок, реализованный в классе `ChessEngine`. Движок использует алгоритм минимакс с альфа-бета отсечением для выбора оптимального хода. Глубина поиска может быть настроена в зависимости от выбранного уровня сложности.

## Хранение данных

### Настройки приложения

Настройки приложения хранятся с использованием `SharedPreferences` через класс `AppSettings`. Основные настройки включают:
- Звук (включен/выключен)
- Вибрация (включена/выключена)
- Подсказки ходов (включены/выключены)
- Тема приложения (классическая, темная, изумрудная, лавандовая)
- Тема шахматной доски (классическая, изумрудная, деревянная, синяя, классическая деревянная)

### Сохранение партий

Сохранение и загрузка партий реализованы с использованием библиотеки Room. Основные компоненты:
- `GameEntity` - сущность для хранения информации о партии в базе данных
- `GameDao` - интерфейс для доступа к данным
- `GameRoomRepository` - репозиторий для работы с базой данных

Партии сохраняются в формате JSON, который включает:
- Последовательность ходов
- Начальную позицию (если отличается от стандартной)
- Информацию о игроках
- Результат партии
- Дату и время

## Пользовательский интерфейс

### Темы оформления

Приложение поддерживает несколько тем оформления, управляемых через класс `ThemeManager`:
- Классическая
- Темная
- Изумрудная
- Лавандовая

Для шахматной доски также доступны различные темы:
- Классическая (черно-белая)
- Изумрудная (белые и изумрудные клетки)
- Деревянная (светло- и темно-коричневые клетки)
- Синяя (белые и синие клетки)
- Классическая деревянная (комбинация)

### Отрисовка шахматной доски

Шахматная доска отрисовывается с помощью Jetpack Compose в компоненте `ChessboardView`. Основные особенности:
- Адаптивный размер доски в зависимости от размера экрана
- Поддержка различных тем оформления
- Анимации перемещения фигур
- Подсветка возможных ходов
- Подсветка последнего хода
- Отображение шаха

### Редактор доски

Редактор шахматной доски позволяет:
- Расставлять фигуры на доске
- Удалять фигуры
- Выбирать, чей ход следующий
- Проверять корректность позиции
- Начинать игру с заданной позиции

Состояние редактора доски отслеживается через класс `EditorBoardState`, который обеспечивает корректное обновление UI при изменении позиции фигур.

## Дополнительные функции

### Анализ партий

Функция анализа партий позволяет:
- Просматривать сохраненные партии
- Перемещаться по ходам вперед и назад
- Анализировать позиции с помощью шахматного движка
- Находить лучшие ходы в каждой позиции

### Шахматные задачи

Приложение содержит набор шахматных задач разной сложности. Для каждой задачи:
- Задана начальная позиция
- Определено условие победы (мат в N ходов)
- Реализована проверка правильности решения

### Обучение

Раздел обучения содержит:
- Базовые правила шахмат
- Тактические приемы
- Стратегические концепции
- Типичные окончания
- Дебютная теория

## Оптимизация производительности

Для обеспечения плавной работы приложения реализованы следующие оптимизации:
- Использование корутин для асинхронных операций
- Кэширование результатов вычислений (например, возможных ходов)
- Ленивая загрузка ресурсов
- Эффективное управление состоянием с помощью StateFlow

## Заключение

ChessBGPU - это современное, функциональное и удобное приложение для игры в шахматы, которое сочетает в себе классическую игру с современными технологиями разработки мобильных приложений. Благодаря использованию архитектуры MVVM, Jetpack Compose и других современных инструментов, приложение обеспечивает плавный пользовательский опыт и легко расширяемую кодовую базу. 